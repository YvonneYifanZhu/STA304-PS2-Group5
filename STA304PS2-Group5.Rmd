---
title: "life satisfaction"
author: "Ruoning Guo, Student No. 1004772114"
date: "10/18/2020"
output:
  pdf_document: 
    latex_engine: xelatex
  html_document:
    df_print: paged
    
mainfont: Times New Roman
fig.align: center
---

```{r , echo=FALSE,results="hide",messange=FALSE,warnings=FALSE,include=FALSE}
library(readr)
library(dplyr)
library(FrF2)
library(kableExtra)
library(ggplot2)


data <- read_csv("/Users/yvonne_zhu/Desktop/STA304 PS2_Oct_19/gss.csv")
vars <- c("feelings_life","total_children","income_family" )
newdata <- data[vars] #20602
newdata <- newdata[!is.na(newdata$feelings_life), ]
newdata <- newdata[!is.na(newdata$income_family), ]

knitr::opts_chunk$set(echo = FALSE,warning = FALSE, message = FALSE,results = "hide")

```

```{r,echo=FALSE}
newdata <- newdata %>%
  head(newdata, n=1000)
attach(newdata)
dim(newdata)
str(newdata)

Children=array(0,1000)
for (i in 1:1000)
{ if (newdata[i,2] > 0)
{Children[i]=1}
}
Children=as.factor(Children)

newdata1 <- cbind(newdata, Children)

attach(newdata1)

library(plyr)

newValueIncome <- c("Less than $25,000"="0-25k","$25,000 to $49,999"="25-50k","$50,000 to $74,999"="50-75k","$75,000 to $99,999"="75-100k","$125,000 and more"="100k+","$100,000 to $ 124,999"="100k+")
newdata1$income <-  revalue(newdata1$income, newValueIncome)


CE <- NULL
for (i in 1:1000)
{ if (newdata1$Children[i]==0 & newdata1$income[i]=="0-25k") 
  {CE[i]="NC0-25k"}
else if (newdata1$Children[i]==0 & newdata1$income[i]=="25-50k") 
  {CE[i]="NC25-50k"}
else if (newdata1$Children[i]==0 & newdata1$income[i]=="50-75k") 
{CE[i]="NC50-75k"}
  else if (newdata1$Children[i]==0 & newdata1$income[i]=="75-100k") 
  {CE[i]="NC75-100k"}
  else if (newdata1$Children[i]==0 & newdata1$income[i]=="100k+") 
{CE[i]="NC100k+"}
else if (newdata1$Children[i]==1 & newdata1$income[i]=="0-25k" )              
  {CE[i]="C0-25k"}
  else if (newdata1$Children[i]==1 & newdata1$income[i]=="25-50k" ) 
  {CE[i]="C25-50k"}
  else if (newdata1$Children[i]==1 & newdata1$income[i]=="50-75k" ) 
  {CE[i]="C50-75k"}
  else if (newdata1$Children[i]==1 & newdata1$income[i]=="75-100k" ) 
  {CE[i]="C75-100k"}
else {CE[i]="C100k+"} }

Children=as.factor(Children)
CE=as.factor(CE)

newdata1 <- newdata1[,-2]
newdata1 <- newdata1[,-2]
```
## Introduction

Life satisfaction at an individual level is extremely important to the well-being of a society. In fact, it can be seen as a measurement for human welfare. Empirical evidence suggests that individuals with higher life satisfaction are more productive. Life satisfaction is also linked to better academic performance among students. Therefore, it is important to understand what factors could contribute to a person’s life satisfaction in order to improve the society as a whole. 
 
This analysis will study how different variables contribute to an individual’s life satisfaction using the Canadian general social surveys (GSS) from 2017. The GSS recorded 20602 individual-level data regarding each respondent’s gender, income, education, etc. In particular, there is a variable that asks the respondents about their “feelings about life as a whole”, which can be seen as a subjective measurement of the respondents’ level of life satisfaction. 
 
The GSS is an annual survey designed to study the living conditions and well-being of Canadians. The target population of this survey is all Canadians; however, the sampling frame is Canadians older than 15 with functional phone number who lives in private households in all provinces excluding the 3 territories. The sampling frame should be a good representation of the target population, therefore the GSS is expected to provide useful and reliable information about living conditions of Canadians.
 
This paper will randomly select 1000 observations from the sampled population of 20602 individuals using SRSWOR, and conduct the study only using the 1000 newly sampled observations. The analysis will be conducted using the one-way ANOVA model. The results will be described, and this paper will conclude with a discussion of potential weaknesses and next steps. 

(When conducting our one-way ANOVA model, we are curious about few questions in the following analysis. First, whether income level influence people's feeling towards life. Second, whether having children or not will significantly change the life satisfaction among all income groups. Third, if there is no difference between people with and without children, we want to study on whether income level would change the feelings of life in groups with or without children)



## Data
In this study, we've created a one-way ANOVA model with three factors - Children, Income, and feeling_life. Children have two levels: the person has children(1) or not(0). Income indicates the annual family income which has five levels: 0-25k, 25-50k, 50-75k, 75-100k, and 100k+. Finally，the feelings_life is the person's feelings of life as a whole on a scale of 1-10. Since the raw dataset was already in a random sequence, there is no need to randomize the sample. So we've selected the first 1000 rows of respondents from the gss2017 dataset. To facilitates the analysis, all rows that include NA in feelings_life and income_family columns have been taking out first. 

```{r,echo=FALSE, results="hide",message=FALSE}

head(newdata1, n=10)

```

## Model

In this study, a one-way analysis of variance(ANOVA) model will be used to investigate whether or not there is a difference in feelings_life among people classified by income and children status. In addition, to investigate whether or not there is a difference in feelings_life among the 10 categories of people classified by the combination of their Children status and income. 

$$FeelingsLife = \beta_0+\beta_1Children+\beta_2Income+\beta_3Children*Income+e$$
Here is our hypotheses before applying the model: 1) feeling of life does depend on income level; 2) having children or not will significantly influence people's satisfaction; 3) lower income group has lower life satisfaction compared with other groups if having children, but this difference is not significant between lower income group and other groups if having no children. 


## Results

### Investigate whether or not there is a difference in the feelings_life between children and nonchildren.
```{r setup, result="hide"}
attach(newdata1)
#have children or no children
children_mean <- tapply(feelings_life,Children,mean)

var.test(feelings_life~Children)

t.test(feelings_life~Children, var.equal=FALSE) #Welch Two Sample t-test

```

- By using F-test for variance, we got the p-value=0.04378 therefore we reject H0, that evidence both groups have different variances.Then we need to use Welch's two sample t-test to adjust the number of degrees of freedom when the variances are different. 
- By using Walch's two-sample t-test, we have t = -1.384, df = 705, p-value = 0.1668. Evidence shows(p=0.17) that people's feelings of life has no difference for people who have children or not. 


### Investigate whether or not there is a difference in feelings_life among people classified by income.
```{r, echo=FALSE, results="hide",fig.align="center"}

tapply(feelings_life,income,mean)

anova(lm(feelings_life~income))

TukeyHSD(aov(feelings_life~as.factor(income)))

plot(TukeyHSD(aov(feelings_life~as.factor(income))))

```

- In order to investigate whether or not there is a difference in feelings_life among people classified by income, we apply one-way analysis of variance. In one-way ANOVA, there are two possible hypotheses.The null hypothesis (H0) is that there is no difference between 5 family income levels and equality between means. The alternative hypothesis (H1) is that there is a difference between the means and levels. 
- After that we have test statistics(df)=26.295(1,998) and P-value<0.0001.This is a strong evidence shows that the means life satisfaction value different from the 5 levels of income. 
- In addition, the Tukey’s procedure also indicates the 5 levels are very different. We capture the people with income group below 25k were significantly different(p-value<0.0001) with all other income groups in mean feelings_life.

```{r, echo=FALSE, results="hide",fig.align="center"}
tapply(feelings_life,CE,mean)

tapply(feelings_life,CE,var)

lm(feelings_life~CE)
anova(lm(feelings_life~CE))

TukeyHSD(aov(feelings_life~CE))

boxplot(feelings_life~CE, main="Feelings of life by CE",ylab="Feelings of life",xlab="CE", xpd=NA,col= "#C3C9D5")  
```


### Investigate whether or not there is a difference in feelings_life among the 10 categories of family members that classified by the combination of their children status and income.

- By using one-way anova, there is strong evident shows that the not all 10 categories of people have same feelings_life means. Since P<0.0001.
- However, through observing the Tukey’s output and then comparing the p-values, evidence shows that people who having children with all income 0-25k, 25k-50k, or 100k+ were no different in mean feelings_life to those who without children (p-value=0.998, 0.999, 0.445 respectively). What's more, non-children people with income below 25k were no different in mean feelings_life to non-children people with income 75-100k and 100k+.(p-value=0.25 and 0.30)



### Checking 3 assumptions of one-way ANOVA model: test validity

- Assumptions of Independence: the independence of observations can not be tested since this assumption can only be satisfied from the design of GSS survey.


- Assumption of Homogeneity of Variance: we conduct Levene's test for homogeneity of variance across groups, which is less sensitive than the Bartlett test to departures from normality. From the test output, p-value=1.81e-05 (much smaller than significant level=0.05) , we reject the null and suggest that the variance across groups is statistically significantly different. Since the classical one-way ANOVA test meets violation, we could relax this assumption in the further study by using Welch one-way test which does not require equal variances. 
```{r,echo=FALSE}
# testing equality 
library(car)
leveneTest(feelings_life ~ CE, data = newdata1)
```

- Assumption of Normality: from the normality plot of residuals below where the quantiles of the residuals are plotted against the quantiles of the normal distribution, we find the majority of observations line on the 45-degree reference line, therefore, assumption of normality holds true. Also, from the plot "Residuals vs Leverage" we detect several outliers, but since majority lay within the Cook's Distance, 2 outliers will not significantly affect normality and homogeneity of variance.
```{r,echo=FALSE}
# illustrate the model's validity
par(mfrow=c(2,2))
res.aov <- aov(feelings_life~CE, newdata1)
plot(res.aov)
```


## Discussion (Nina)
From the result section, we drawn conclusion that 

After analyzing the dataset of GSS data, we were able to discover the impact of each different factor in determining “happiness.” We had also found that among the different factors, “” tends to have the greatest happiness with “” and “” support following by. Our hypothesis that a rich life and healthy body are the biggest influencing factors affecting happiness. 

However, the data in our analysis is only 2019, which does not fully explain the factors that affect people's happiness. Our figures will change with immigration and pandemics, or other technological revolutions. We are able to understand what makes countries and their people happy by reviewing these data analysis, thereby enabling us to concentrate on prioritizing and optimizing these facets of the country.

comment on how it relates to the original goal of the study

# Weaknesses (Nina)
If we used linear regression model to apply and analyze the impact of happiness score from those variables we picked, some response may not fit linear regression assumptions, causing assumption violation.For example, we know that Y variable only takes discrete values from 1-10, Which violates the linearity assumption, because we know the true relationship between our predictors and response is NOT linear. Also, it means that the epsilon will not follow a normal distribution because Y is discrete : Normal can takes all values in R. Thus, we controlled one variable y-feelings_life, and several independent variables (categorical), using ANOVA to analysis these variables.

weaknesses of the study, data, analysis, improvement.
(sex, omitted variable bias)
two variables(multico)

# Next Steps (Kyle)

Other than using ANOVA, an alternative option might (or might not) be using "multinomial logistic regression" (Ordinal Logistic Regression)

next steps in terms of statistical analysis (perhaps there is a more efficient algorithm available, or perhaps there is a caveat in the data that would allow for some new technique). 
study setting (eg. including a follow-up survey on something, or a subsequent study that would complement the conclusions of your report).


## References



